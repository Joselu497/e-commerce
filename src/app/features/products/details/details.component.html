@if (!isLoading() && product) {
<div class="max-w-4xl">
    <div class="bg-white shadow-sm ring-1 ring-gray-900/5 rounded-lg p-3 sm:p-6">
        <div class="sm:flex gap-6">
            <div class="flex justify-center p-2 sm:justify-start">
                <img [src]="product.image" alt="Product image" class="h-auto w-64 max-w-full object-contain">
            </div>
            <div class="flex flex-col gap-2 flex-1">
                <div class="flex-1 flex flex-col gap-3">
                    <h2 class="text-xl font-semibold text-gray-900">{{ product.title }}</h2>
                    <p class="text-gray-600 text-sm">{{ product.description }}</p>
                    <div class="flex items-center sm:justify-start sm:gap-5 justify-between">
                        <div class="flex items-center gap-2">
                            <span
                                class="bg-indigo-50 rounded-lg ring-1 ring-indigo-300 px-2 py-1 font-semibold text-sm text-indigo-700">
                                {{ product.category }}
                            </span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="flex items-center bg-indigo-50 ring-1 ring-indigo-300 px-2 py-1 rounded-lg">
                                <span class="text-sm font-semibold text-indigo-700">{{ product.rating.rate }}</span>
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                    class="size-4 text-yellow-400 ml-1">
                                    <path fill-rule="evenodd"
                                        d="M10.868 2.884c-.321-.772-1.415-.772-1.736 0l-1.83 4.401-4.753.381c-.833.067-1.171 1.107-.536 1.651l3.62 3.102-1.106 4.637c-.194.813.691 1.456 1.405 1.02L10 15.591l4.069 2.485c.713.436 1.598-.207 1.404-1.02l-1.106-4.637 3.62-3.102c.635-.544.297-1.584-.536-1.65l-4.752-.382-1.831-4.401z"
                                        clip-rule="evenodd" />
                                </svg>
                            </div>
                            <span class="text-sm text-gray-500">({{ product.rating.count }}) reviews</span>
                        </div>
                    </div>
                    <p class="text-xl font-bold text-gray-900">${{ product.price }}</p>
                </div>
                <div class="flex items-center sm:gap-2 mt-4 sm:justify-end justify-between">
                    <button (click)="onBack()" type="button"
                        class="bg-gray-200 font-semibold text-gray-900 px-4 py-2 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer inline-flex gap-2 items-center">
                        Back to catalog
                    </button>
                    @if (isAuthenticated()) {
                    <button (click)="onAddToCart(product)"
                        class="bg-indigo-600 font-semibold text-white px-4 py-2 rounded-lg hover:bg-indigo-500 transition-colors cursor-pointer inline-flex gap-2 items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5">
                            <path
                                d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z" />
                        </svg>
                        Add to cart
                    </button>
                    }
                </div>
            </div>
        </div>
        <div class="mt-6 border-t pt-6 w-full">
            @if(!isLoadingRelated() && relatedProducts.length > 0) {
            <h2 class="text-xl font-semibold text-gray-900 mb-4">Recommended for you</h2>
            <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-2 sm:gap-4">
                @for(product of relatedProducts; track product.id) {
                <div class="flex flex-col bg-gray-100 p-3 rounded-lg">
                    <div class="h-48 flex items-center justify-center">
                        <img [src]="product.image" alt="Product image" class="max-w-full max-h-full object-contain">
                    </div>
                    <div class="mt-2 flex-1">
                        <h3 class="text-sm font-medium text-gray-900 truncate">{{ product.title }}</h3>
                        <p class="text-lg font-bold text-gray-900 mt-1">${{ product.price }}</p><a
                            [routerLink]="'../' + product.id"
                            class="cursor-pointer text-sm text-indigo-600 font-semibold">View details</a>
                    </div>
                </div>
                }
            </div>
            } @else if (isLoadingRelated()) {
            <div class="flex justify-center items-center">
                <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-600"></div>
            </div>
            }
        </div>
    </div>
</div>
} @else if (isLoading()) {
<div class="flex justify-center items-center min-h-[calc(100vh-10.25rem)]">
    <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-600"></div>
</div>
} @else {
<div class="flex flex-col justify-center items-center min-h-[calc(100vh-10.25rem)]">
    <h2 class="text-2xl font-semibold text-gray-900">Something went wrong</h2>
    <p class="text-xl text-gray-600">Please try refreshing the page</p>
</div>
}